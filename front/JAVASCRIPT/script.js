//mockData////////////////////////////////////////////////////
function mockData() {
    return {
        "results": [
            {
                id_product: 1,
                productTitle: "Queen of the Pyrenees",
                description: "The majesty of the Pyrenees in every bite. Tender and juicy Ternasco de Aragón lamb, accompanied by creamy Tronchón cheese, roasted Tudela asparagus, and a unique truffle sauce that adds a sophisticated touch. All served on rustic handmade bread that enhances the local flavors. A tribute to the heart of the Aragonese Pyrenees.",
                price: 16.50,
                id_productCategory: 1,
                image: '../Images/products/burgers/1_hamburguesa---queen-of-the-pyrenees----the-majesty.png',

            },
            {
                id_product: 2,
                productTitle: "Under the Skies of Belchite",
                description: "Inspired by the lands of Belchite, this burger brings together the best of the garden and tradition. Jiloca beef with a hint of Belchite honey and Fraga mustard creates the perfect balance of sweet and tangy. Served with caramelized onions, local Raf tomatoes, and spelt bread. An explosion of flavors that takes you straight to Belchite.",
                price: 14.50,
                id_productCategory: 1,
                image: '../Images/products/burgers/2_hamburguesa----under-the-shadow-of-the-muela----th.png',
            },
            {
                id_product: 3,
                productTitle: "The Shadow of Moncayo",
                description: "The shadow cast by Moncayo inspires this burger, combining the best of the mountains with the freshness of the garden. Juicy Aragonese chicken breast, accompanied by Moncayo fresh cheese, Tudela asparagus, and a refreshing Aragonese yogurt sauce. All served on seed bread, perfectly balancing the flavors.",
                price: 15.00,
                id_productCategory: 1,
                image: '../Images/products/burgers/3_hamburguesa----the-shadow-of-moncayo----the-shadow.png',
            },
            {
                id_product: 4,
                productTitle: "Ebro River",
                description: "A tribute to the majestic Ebro River. Ebro River trout with a smoky touch, accompanied by roasted Piquillo peppers and a drizzle of extra virgin olive oil. The smoothness of Manchego cheese and the freshness of field lettuce make this burger a unique experience, all on rye bread.",
                price: 17.00,
                id_productCategory: 1,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 5,
                productTitle: "Land of Biescas",
                description: "In honor of the lands of Biescas, this burger combines the intensity of Albarracín lamb with the creamy touch of Manchego cheese and the richness of sun-dried tomatoes. A rosemary sauce and rustic village bread complete this mountain-inspired recipe. The flavor of the highlands in every bite.",
                price: 18.00,
                id_productCategory: 1,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 6,
                productTitle: "The Hoya of Huesca",
                description: "Inspired by the fertile Hoya of Huesca, this burger features Barbastro beef paired with Piquillo peppers and a mild sweet mustard sauce. Combined with Moncayo fresh cheese and a touch of caramelized onions on rustic bread, this is a blend of traditional flavors with a modern twist.",
                price: 14.00,
                id_productCategory: 1,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 7,
                productTitle: "Fields of Jiloca",
                description: "Known for its authentic flavors, the fields of Jiloca are reflected in this burger. Jiloca beef accompanied by Tronchón cheese, sun-dried tomatoes, and a fresh mix of spinach leaves, all topped with Belchite honey sauce and served on spelt bread. A tribute to Aragonese land.",
                price: 13.50,
                id_productCategory: 1,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 8,
                productTitle: "Dawn of the Maestre",
                description: "A dawn in the Maestre lands is reflected in this burger full of freshness and contrast. Local pork with Moncayo fresh cheese, Piquillo peppers, and a touch of Belchite honey and sweet mustard create a perfectly balanced and delicious flavor. Served on rye bread for a gourmet experience.",
                price: 16.00,
                id_productCategory: 1,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 9,
                productTitle: "The Matarraña Lamb",
                description: "The richness of Matarraña is found in this burger made with Ternasco de Aragón lamb, accompanied by Manchego cheese, caramelized onions, and a hint of Fraga mustard sauce. The seed bread and arugula leaves complement the blend of flavors, creating a unique taste of the land.",
                price: 17.50,
                id_productCategory: 1,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 10,
                productTitle: "Wind of Teruel",
                description: "The wind of Teruel brings the strength of tradition. This burger combines wild boar meat from the Sierra de Guara, with Manchego cheese, sun-dried tomatoes, and a touch of sweet mustard sauce. All served on rustic bread, evoking the wild flavors of Teruel in every bite.",
                price: 14.50,
                id_productCategory: 1,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 11,
                productTitle: "Essence of the Gállego",
                description: "The essence of the Gállego land is found in this burger of Gállego goat meat, paired with Manchego cheese, Raf tomatoes, and a mild rosemary sauce. Served on rustic bread, this is a taste of authenticity from the region.",
                price: 15.00,
                id_productCategory: 1,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 12,
                productTitle: "Under the Shadow of the Muela",
                description: "The Muela inspires this burger made with rabbit meat from La Muela, a touch of apple compote, and sweet mustard sauce. Served with spinach leaves, Raf tomatoes, and a drizzle of extra virgin olive oil, all on rye bread. A delicate and flavorful mix that takes you to the calm of the lands under the shadow of the Muela.",
                price: 13.00,
                id_productCategory: 1,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 13,
                productTitle: "The Green Alfranca",
                description: "The freshness of the Alfranca fields is reflected in this burger. Beef paired with Moncayo fresh cheese, arugula sprouts, and a touch of extra virgin olive oil on seed bread. A combination of fresh and tasty ingredients for a light yet delicious experience.",
                price: 14.00,
                id_productCategory: 1,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 14,
                productTitle: "Skies of the Sierra de Guara",
                description: "The majesty of the skies of the Sierra de Guara is reflected in this burger made with wild boar meat, Tronchón cheese, Piquillo peppers, and a mild rosemary sauce. Served on rustic bread, this burger offers robust and authentic mountain flavors.",
                price: 18.00,
                id_productCategory: 1,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 15,
                productTitle: "Barbastro Estate",
                description: "A journey to the Barbastro Estate with this burger made from local Barbastro beef, Manchego cheese, sun-dried tomatoes, and a hint of Belchite honey. The perfect combination of local flavors on rye bread, ideal for savoring the best of the land.",
                price: 15.50,
                id_productCategory: 1,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 16,
                productTitle: "Gourmet French Fries",
                description: "Crispy, golden fries cooked to perfection, drizzled with extra virgin olive oil and fresh rosemary. The ideal side for any burger.",
                price: 4.00,
                id_productCategory: 2,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 17,
                productTitle: "Crispy Onion Rings",
                description: "Golden, battered onion rings, seasoned with local spices, crispy on the outside and tender on the inside.",
                price: 5.00,
                id_productCategory: 2,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 18,
                productTitle: "Fresh Salad",
                description: "A fresh mix of lettuce, arugula, Raf tomatoes, and caramelized onions, dressed with extra virgin olive oil and balsamic vinegar.",
                price: 5.00,
                id_productCategory: 2,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 19,
                productTitle: "Water",
                description: "A refreshing bottle of water to accompany your meal.",
                price: 2.00,
                id_productCategory: 3,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 20,
                productTitle: "Cola Soda",
                description: "A classic Coca-Cola, sweet and refreshing.",
                price: 1.50,
                id_productCategory: 3,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 21,
                productTitle: "Lemon Soda",
                description: "A refreshing orange soda with a sweet and tangy taste.",
                price: 1.50,
                id_productCategory: 3,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 22,
                productTitle: "Orange Soda",
                description: "A refreshing lemon soda, perfect for a hot day.",
                price: 1.50,
                id_productCategory: 3,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 23,
                productTitle: "Cariñena Red Wine",
                description: "A smooth red wine from the Cariñena region, perfect for pairing with any meal.",
                price: 6.00,
                id_productCategory: 3,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 24,
                productTitle: "Somontano White Wine",
                description: "A crisp and aromatic white wine from the Somontano region, ideal for seafood or chicken dishes.",
                price: 6.00,
                id_productCategory: 3,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            },
            {
                id_product: 25,
                productTitle: "Beer",
                description: "A refreshing local beer from the Ambar brewery.",
                price: 2.00,
                id_productCategory: 3,
                image: "https://cdn-icons-png.flaticon.com/512/73/73775.png",
            }
        ]
        
    };
}




//CARD CREATOR//////////////////////////////////////////////////////////////
function createProductCard(product, container) {
    const card = document.createElement('div');
    card.classList.add('card');

    card.innerHTML = `
    <div id="product-id-${product.id_product}">
        <img src="${product.image}" alt="${product.productTitle || 'Product Image'}"  class="product-photo" data-id="${product.id_product}">
        <div class="card-details">
            <h4 class="product-name">${product.productTitle}</h4>
            <div class="inputs">
                <div class="price-quantity">
                    <p class="price">${product.price}€</p>  
                </div>
                <div class="quantity-controllers">
                    <button onclick="increment(${product.id_product})"   class="button-add-cart button-increase">+</button>
                    <button onclick="decrement(${product.id_product})" class="button-add-cart button-decrease">-</button>
                </div>
            </div>
        </div>
    </div>
    `;
    container.appendChild(card);
}



/////////product by categories////////////////////

 function getProducts(category, container){          //it must be async when we call api
    try {
        const data = mockData(); // Simulating API call

        //group by category in a new array 
        const arrayProductsByCategory = data.results.filter(product => product.id_productCategory === category);

        //create card
        arrayProductsByCategory.forEach(product => createProductCard(product, container));


    }catch (error) {
        console.error(`Error in getting product`, error);
    }
}




/////////////////////load products

window.addEventListener('load', () => {

const burgersContainer = document.getElementById("burgers-container");
getProducts(1, burgersContainer);

const sidesContainer = document.getElementById("sides-container");
getProducts(2, sidesContainer);

const drinksContainer = document.getElementById("drinks-container");
getProducts(3, drinksContainer);

calculation();  //calculate porducts in basket
setUpProductClick();

}
);


// WHEN WE CLICK IN AN IMAGE WE ARE REDIRECTED TO THE DETAIL-PAGE/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


function setUpProductClick(){
    const allImages = document.querySelectorAll(".product-photo");


//we add and eventlistener onclick for images
    allImages.forEach((element) =>{
        element.addEventListener("click", ()=>{

            // we capture id
            let id = parseInt(element.getAttribute("data-id"));

            //find the product that has this id
            const selectedProduct = mockData().results.find(prod => prod.id_product === id);

            //we keep this productin localstorage
            localStorage.setItem("clickedProduct", JSON.stringify(selectedProduct));

            //redirect to detail-page with the searchArgument
            window.location.href =`burger-detail.html?idProduct=${id}`;
        });
    });
}




//basket//////////////////////////////////////////////////////////////////////////////////////////////////////////////
let basket = JSON.parse(localStorage.getItem("data")) || [];
//before, basket was [] but we want to take the infomration from localStorge. an object with "data" key is added when we click on controllers.
//  if nothing exist, return an empty array  --> in order not to get an error





// Functions to change  quantity  
function increment(id) {
    let selectedItem = id;

    let search = basket.find((x) => x.id_product === selectedItem);
    //it is searching for the object wich we have selected. it returns wether if it exist in the basket yet

    if (search === undefined) {

        //we find the object from api and we save it in a variable
        const  productData = mockData().results.find((product) => product.id_product === selectedItem);

        //add to the basket
        basket.push({
            ...productData,   //Appends new elements to the end of an array, and returns the new length of the array.
            item: 1,    //amount bought

        });
    } else {
        search.item++;
    }


    localStorage.setItem("data", JSON.stringify(basket));
    //keyvalue: data is the key, basket is the value that we keep
    //basket is an object. if we want to safe data (not only "object") we have to transform it into a json by json.stringify "into a string"
    console.log("actualizing basket")
    calculation();
    console.log("product added")
}

function decrement(id) {
    let selectedItem = id;

    let search = basket.find((x) => x.id_product === selectedItem);
    //it is searching for the object wich we have selected. i t returns  wether if it exist in the basket yet

    //if object doesn´t exist
    if (!search) {
        return;
    }
 //if quantity is more than 0 quit one
    if (search.item > 0) {
        search.item--;
    }


// if is 0 remove item from basket
    if (search.item === 0) {
        basket = basket.filter(x => x.id_product !== selectedItem); //filter return a new array with products wich quantity is not zero. it filters when id is different than selected item to include it in array

    }

    localStorage.setItem("data", JSON.stringify(basket));
    //keyvalue: data is the key, basket is the value that we keep
    //basket is an object. if we want to safe data (not only "object") we have to transform it into a json by json.stringify "into a string"
    //console.log(basket);
    // update(selectedItem.id);
    calculation();
}

let calculation = () => {
    let cartIcon = document.getElementById("cartAmount");

     // data of basket from localstorage
     let basketData = JSON.parse(localStorage.getItem("data")) || [];
    
    cartIcon.innerHTML = basketData.reduce((total, x) => total + x.item, 0);
    /*The reduce() function in JavaScript accumulates values from an array into a single result.
         total starts at 0 (the second argument in reduce()).
        Each x represents an object in the basket array.
        In every iteration, total adds x.item, accumulating the total quantity.
        the first argument(total is always de accumulator. it is "implicitaly defined as 0)
    */
};



